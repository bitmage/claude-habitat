name: claude-habitat
description: Development environment for Claude Habitat itself

# Habitat tests (run with: claude-habitat test claude-habitat)
tests:
  - tests/test-claude-habitat-inception.sh

image:
  dockerfile: Dockerfile
  tag: claude-habitat-dev:latest

repositories:
  - url: https://github.com/bitmage/claude-habitat  
    path: /src
    branch: main
    shallow: true

environment:
  - NODE_ENV=development
  - DOCKER_HOST=unix:///var/run/docker.sock

volumes:
  # Mount Docker socket for container management
  - /var/run/docker.sock:/var/run/docker.sock
  # Optional: Mount local code for live development
  # - ./:/workspace/claude-habitat

setup:
  root:
    - |
      # Install Docker CLI (not daemon)
      apt-get update && apt-get install -y docker.io
      
      # Ensure docker group exists and add user
      groupadd -f docker
      usermod -aG docker node
      
      # Fix Docker socket permissions
      chmod 666 /var/run/docker.sock || true
      
  user:
    run_as: node
    commands:
      - |
        cd /src
        echo "Installing Claude Habitat dependencies..."
        npm install
        echo "Running tests to verify setup..."
        npm test
        echo "Claude Habitat setup complete"

container:
  work_dir: /src
  user: node
  init_command: /sbin/init
  startup_delay: 5

# Filesystem verification structure
verify-fs:
  required_files:
    # Main claude-habitat source files
    - /src/.git/config
    - /src/CLAUDE.md
    - /src/README.md
    - /src/package.json
    - /src/package-lock.json
    - /src/claude-habitat
    - /src/claude-habitat.js
    - /src/claude-habitat.sh
    - /src/habitats/base/config.yaml
    - /src/habitats/discourse/config.yaml
    - /src/test/unit/claude-habitat.test.js
    - /src/node_modules/package.json
    # Helper files in claude-habitat subdirectory
    - /src/claude-habitat/system/CLAUDE.md
    - /src/claude-habitat/system/tools/tools.yaml
    - /src/claude-habitat/shared/CLAUDE.md
    - /src/claude-habitat/shared/config.yaml
    - /src/claude-habitat/local/CLAUDE.md
    - /src/claude-habitat/local/config.yaml

# Disable automatic Claude instruction generation
claude:
  command: claude --dangerously-skip-permissions
  disable_habitat_instructions: true
